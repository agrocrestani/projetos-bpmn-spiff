<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:spiffworkflow="http://spiffworkflow.org/bpmn/schema/1.0/core" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" id="Definitions_96f6665" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="3.0.0-dev">
  <bpmn:process id="Process_registro_de_admisso_colaboradores_5reiwhf" isExecutable="true">
    <bpmn:startEvent id="IPACTIORH01">
      <bpmn:outgoing>Flow_1bb8s6f</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:endEvent id="EndEvent_1">
      <bpmn:incoming>Flow_0q548we</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="Flow_12pkbxb" sourceRef="ACTIORH01" targetRef="Activity_0tow411" />
    <bpmn:userTask id="ACTIORH01" name="Inserir dados Colaboradores">
      <bpmn:extensionElements>
        <spiffworkflow:instructionsForEndUser>{% if correcao %}
&lt;font color="red"&gt;&lt;strong&gt;Corrija os dados dos colaboradores!!&lt;/strong&gt;&lt;/font&gt;
{% endif %}</spiffworkflow:instructionsForEndUser>
        <spiffworkflow:properties>
          <spiffworkflow:property name="formJsonSchemaFilename" value="action-rh01-schema.json" />
          <spiffworkflow:property name="formUiSchemaFilename" value="action-rh01-uischema.json" />
        </spiffworkflow:properties>
        <spiffworkflow:preScript />
        <spiffworkflow:postScript />
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0zyhysy</bpmn:incoming>
      <bpmn:incoming>Flow_00nnl2s</bpmn:incoming>
      <bpmn:outgoing>Flow_12pkbxb</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:sequenceFlow id="Flow_0etx8vl" sourceRef="Activity_0tow411" targetRef="Gateway_1bf21pw" />
    <bpmn:serviceTask id="LoginActio" name="Login Actio">
      <bpmn:extensionElements>
        <spiffworkflow:preScript>url = "https://crestani-webapi.actiosoftware.com/api/auth"

data = {
    "email":"mailon.campos@agrocrestani.com.br",
    "password":"AndressaWin2@"
}

headers = {
  'Content-Type': 'application/json'
}</spiffworkflow:preScript>
        <spiffworkflow:serviceTaskOperator id="http/PostRequestV2" resultVariable="response">
          <spiffworkflow:parameters>
            <spiffworkflow:parameter id="url" type="str" value="url" />
            <spiffworkflow:parameter id="headers" type="any" value="headers" />
            <spiffworkflow:parameter id="data" type="any" value="data" />
            <spiffworkflow:parameter id="basic_auth_username" type="str" />
            <spiffworkflow:parameter id="basic_auth_password" type="str" />
            <spiffworkflow:parameter id="verify" type="bool" />
          </spiffworkflow:parameters>
        </spiffworkflow:serviceTaskOperator>
        <spiffworkflow:postScript>body = response['body']
accessToken = body['accessToken']

param = "?page=0&amp;pageSize=1000"

headers = {
    'Content-Type': 'application/json',
    'Authorization': 'Bearer ' + accessToken
}</spiffworkflow:postScript>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_1dqg7jg</bpmn:incoming>
      <bpmn:outgoing>Flow_0jf2rzh</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:sequenceFlow id="Flow_0q548we" sourceRef="RegistrarParametros" targetRef="EndEvent_1" />
    <bpmn:serviceTask id="RegistrarParametros" name="Registrar Parametros">
      <bpmn:extensionElements>
        <spiffworkflow:preScript># Definindo as variáveis
url = "https://crestani-webapi.actiosoftware.com/api/values/executedValues"

headers = {
    'Content-Type': 'application/json',
    'Authorization': 'Bearer ' + accessToken
}

# Obtendo os valores dos funcionários das filiais
funcAtivosMatriz = filialEscritorio['escritorioAtivos']
funcDemitidosMatriz = filialEscritorio['escritorioDemitidos']
funcAtivosBrasnorte = filialBrasnorte['brasnorteAtivos']
funcDemitidosBrasnorte = filialBrasnorte['brasnorteDemitidos']
funcAtivosQuerencia = filialQuerencia['querenciaAtivos']
funcDemitidosQuerencia = filialQuerencia['querenciaDemitidos']
funcAtivosCamposDeJulio = filialCamposDeJulio['camposDeJulioAtivos']
funcDemitidosCamposDeJulio = filialCamposDeJulio['camposDeJulioDemitidos']

# Definindo os dados a serem enviados
data = [
    {
        "itemCode": "RH.PAR.004",
        "period": mes,
        "year": ano,
        "executedValue": funcAtivosMatriz
    },
    {
        "itemCode": "RH.PAR.008",
        "period": mes,
        "year": ano,
        "executedValue": funcDemitidosMatriz
    },
    {
        "itemCode": "RH.PAR.001",
        "period": mes,
        "year": ano,
        "executedValue": funcAtivosBrasnorte
    },
    {
        "itemCode": "RH.PAR.005",
        "period": mes,
        "year": ano,
        "executedValue": funcDemitidosBrasnorte
    },
    {
        "itemCode": "RH.PAR.003",
        "period": mes,
        "year": ano,
        "executedValue": funcAtivosQuerencia
    },
    {
        "itemCode": "RH.PAR.007",
        "period": mes,
        "year": ano,
        "executedValue": funcDemitidosQuerencia
    },
    {
        "itemCode": "RH.PAR.002",
        "period": mes,
        "year": ano,
        "executedValue": funcAtivosCamposDeJulio
    },
    {
        "itemCode": "RH.PAR.006",
        "period": mes,
        "year": ano,
        "executedValue": funcDemitidosCamposDeJulio
    }
]</spiffworkflow:preScript>
        <spiffworkflow:serviceTaskOperator id="http/PostRequestV2" resultVariable="response">
          <spiffworkflow:parameters>
            <spiffworkflow:parameter id="url" type="str" value="url" />
            <spiffworkflow:parameter id="headers" type="any" value="headers" />
            <spiffworkflow:parameter id="data" type="any" value="data" />
            <spiffworkflow:parameter id="basic_auth_username" type="str" />
            <spiffworkflow:parameter id="basic_auth_password" type="str" />
            <spiffworkflow:parameter id="verify" type="bool" />
          </spiffworkflow:parameters>
        </spiffworkflow:serviceTaskOperator>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_1k2os5v</bpmn:incoming>
      <bpmn:outgoing>Flow_0q548we</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:userTask id="Activity_0tow411" name="Confirma dados dos Colaboradores">
      <bpmn:extensionElements>
        <spiffworkflow:serviceTaskOperator id="http/PostRequestV2" resultVariable="response">
          <spiffworkflow:parameters>
            <spiffworkflow:parameter id="url" type="str" />
            <spiffworkflow:parameter id="headers" type="any" />
            <spiffworkflow:parameter id="data" type="any" />
            <spiffworkflow:parameter id="basic_auth_username" type="str" />
            <spiffworkflow:parameter id="basic_auth_password" type="str" />
            <spiffworkflow:parameter id="verify" type="bool" />
          </spiffworkflow:parameters>
        </spiffworkflow:serviceTaskOperator>
        <spiffworkflow:properties>
          <spiffworkflow:property name="formJsonSchemaFilename" value="confirmar-dados-schema.json" />
          <spiffworkflow:property name="formUiSchemaFilename" value="confirmar-dados-uischema.json" />
        </spiffworkflow:properties>
        <spiffworkflow:instructionsForEndUser>### Funcionários Matriz
| Situação | Quantidade |
| ---------- | :----------: |
| Ativos | {{filialEscritorio['escritorioAtivos']}} |
| Demitidos | {{filialEscritorio['escritorioDemitidos']}} |

### Funcionários Brasnorte
| Situação | Quantidade |
| ---------- | :----------: |
| Ativos | {{filialBrasnorte['brasnorteAtivos']}} |
| Demitidos | {{filialBrasnorte['brasnorteDemitidos']}} |

### Funcionários Querência
| Situação | Quantidade |
| ---------- | :----------: |
| Ativos | {{filialQuerencia['querenciaAtivos']}} |
| Demitidos | {{filialQuerencia['querenciaDemitidos']}} |

### Funcionários Campos de Júlio
| Situação | Quantidade |
| ---------- | :----------: |
| Ativos | {{filialCamposDeJulio['camposDeJulioAtivos']}} |
| Demitidos | {{filialCamposDeJulio['camposDeJulioDemitidos']}} |
</spiffworkflow:instructionsForEndUser>
        <spiffworkflow:preScript />
        <spiffworkflow:postScript>correcao = not done
</spiffworkflow:postScript>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_12pkbxb</bpmn:incoming>
      <bpmn:outgoing>Flow_0etx8vl</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:exclusiveGateway id="Gateway_1bf21pw" default="Flow_1k2os5v">
      <bpmn:incoming>Flow_0etx8vl</bpmn:incoming>
      <bpmn:outgoing>Flow_1k2os5v</bpmn:outgoing>
      <bpmn:outgoing>Flow_0zyhysy</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="Flow_1k2os5v" sourceRef="Gateway_1bf21pw" targetRef="RegistrarParametros">
      <bpmn:conditionExpression>done == True</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_0zyhysy" sourceRef="Gateway_1bf21pw" targetRef="ACTIORH01">
      <bpmn:conditionExpression>done == False</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_1dqg7jg" sourceRef="SELECIONAR_PERIODO" targetRef="LoginActio" />
    <bpmn:userTask id="SELECIONAR_PERIODO" name="Selecionar Período">
      <bpmn:extensionElements>
        <spiffworkflow:preScript>meses = [
    {"value": "1", "label": "Janeiro"},
    {"value": "2", "label": "Fevereiro"},
    {"value": "3", "label": "Março"},
    {"value": "4", "label": "Abril"},
    {"value": "5", "label": "Maio"},
    {"value": "6", "label": "Junho"},
    {"value": "7", "label": "Julho"},
    {"value": "8", "label": "Agosto"},
    {"value": "9", "label": "Setembro"},
    {"value": "10", "label": "Outubro"},
    {"value": "11", "label": "Novembro"},
    {"value": "12", "label": "Dezembro"}
]

anos = [
    {"value": "2024", "label": "2024"},
    {"value": "2025", "label": "2025"},
    {"value": "2026", "label": "2026"},
    {"value": "2027", "label": "2027"},
    {"value": "2028", "label": "2028"}
]</spiffworkflow:preScript>
        <spiffworkflow:properties>
          <spiffworkflow:property name="formJsonSchemaFilename" value="selecionar-periodo-schema.json" />
          <spiffworkflow:property name="formUiSchemaFilename" value="selecionar-periodo-uischema.json" />
        </spiffworkflow:properties>
        <spiffworkflow:postScript>ano = datasReferencia['ano']
mes = datasReferencia['mes']</spiffworkflow:postScript>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_1bb8s6f</bpmn:incoming>
      <bpmn:outgoing>Flow_1dqg7jg</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:sequenceFlow id="Flow_00nnl2s" sourceRef="BUSCAR_PARAMETROS" targetRef="ACTIORH01" />
    <bpmn:serviceTask id="BUSCAR_PARAMETROS" name="Buscar Parâmetros">
      <bpmn:extensionElements>
        <spiffworkflow:serviceTaskOperator id="http/GetRequestV2" resultVariable="response">
          <spiffworkflow:parameters>
            <spiffworkflow:parameter id="url" type="str" value="url" />
            <spiffworkflow:parameter id="headers" type="any" value="headers" />
            <spiffworkflow:parameter id="params" type="any" value="param" />
            <spiffworkflow:parameter id="basic_auth_username" type="str" />
            <spiffworkflow:parameter id="basic_auth_password" type="str" />
            <spiffworkflow:parameter id="verify" type="bool" />
            <spiffworkflow:parameter id="attempts" type="int" />
          </spiffworkflow:parameters>
        </spiffworkflow:serviceTaskOperator>
        <spiffworkflow:preScript>url = "https://crestani-webapi.actiosoftware.com/api/values/alltypes-values"</spiffworkflow:preScript>
        <spiffworkflow:postScript>parametro_encontrados = response['body']

filialBrasnorte = {
    'brasnorteAtivos': None,
    'brasnorteDemitidos': None
}

filialCamposDeJulio = {
    'camposDeJulioAtivos': None,
    'camposDeJulioDemitidos': None
}

filialQuerencia = {
    'querenciaAtivos': None,
    'querenciaDemitidos': None
}

filialEscritorio = {
    'escritorioAtivos': None,
    'escritorioDemitidos': None
}

print("LOG - Entrou no Periodo")

for parametros in parametro_encontrados:
    if(ano == str(parametros['year']) and mes == str(parametros['period'])):
        if(parametros['itemCode'] == 'RH.PAR.001'):            
            try:
                filialBrasnorte['brasnorteAtivos'] = parametros['executedValue']
            except:
                print("Não tem valor gravado")
                
        if(parametros['itemCode'] == 'RH.PAR.002'):            
            try:
                filialCamposDeJulio['camposDeJulioAtivos'] = parametros['executedValue']
            except:
                print("Não tem valor gravado")

        if(parametros['itemCode'] == 'RH.PAR.003'):
            try:
                filialQuerencia['querenciaAtivos'] = parametros['executedValue']
            except:
                print("Não tem valor gravado")
                
        if(parametros['itemCode'] == 'RH.PAR.004'):            
            try:
                filialEscritorio['escritorioAtivos'] = parametros['executedValue']
                print('Tem valor aqui RH.PAR.004')
            except:
                print("Não tem valor gravado")

        if(parametros['itemCode'] == 'RH.PAR.005'):
            print("LOG - Entrou no RH.PAR.005")
            
            try:
                filialBrasnorte['brasnorteDemitidos'] = parametros['executedValue']
                print('Tem valor aqui RH.PAR.005')
            except:
                print("Não tem valor gravado")

        if(parametros['itemCode'] == 'RH.PAR.006'):
            print("LOG - Entrou no RH.PAR.006")
            
            try:
                filialCamposDeJulio['camposDeJulioDemitidos'] = parametros['executedValue']
                print('Tem valor aqui RH.PAR.006')
            except:
                print("Não tem valor gravado")

        if(parametros['itemCode'] == 'RH.PAR.007'):
            print("LOG - Entrou no RH.PAR.007")
            
            try:
                filialQuerencia['querenciaDemitidos'] = parametros['executedValue']
                print('Tem valor aqui RH.PAR.007')
            except:
                print("Não tem valor gravado")
                
        if(parametros['itemCode'] == 'RH.PAR.008'):
            print("LOG - Entrou no RH.PAR.008")
            
            try:
                filialEscritorio['escritorioDemitidos'] = parametros['executedValue']
                print('Tem valor aqui RH.PAR.008')
            except:
                print("Não tem valor gravado")

del(body)
del(response)
del(param)

</spiffworkflow:postScript>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0jf2rzh</bpmn:incoming>
      <bpmn:outgoing>Flow_00nnl2s</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:sequenceFlow id="Flow_0jf2rzh" sourceRef="LoginActio" targetRef="BUSCAR_PARAMETROS" />
    <bpmn:sequenceFlow id="Flow_1bb8s6f" sourceRef="IPACTIORH01" targetRef="SELECIONAR_PERIODO" />
  </bpmn:process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Process_registro_de_admisso_colaboradores_5reiwhf">
      <bpmndi:BPMNShape id="Activity_1fjxmla_di" bpmnElement="ACTIORH01">
        <dc:Bounds x="320" y="137" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1fdc04x_di" bpmnElement="Activity_0tow411">
        <dc:Bounds x="480" y="137" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_1bf21pw_di" bpmnElement="Gateway_1bf21pw" isMarkerVisible="true">
        <dc:Bounds x="635" y="152" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="IPACTIORH01">
        <dc:Bounds x="-288" y="159" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1ujnjlg_di" bpmnElement="SELECIONAR_PERIODO">
        <dc:Bounds x="-210" y="137" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1yoq94z_di" bpmnElement="LoginActio">
        <dc:Bounds x="-40" y="137" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1447j65_di" bpmnElement="BUSCAR_PARAMETROS">
        <dc:Bounds x="130" y="137" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_032f4vz_di" bpmnElement="RegistrarParametros">
        <dc:Bounds x="770" y="137" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_14za570_di" bpmnElement="EndEvent_1">
        <dc:Bounds x="982" y="159" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_12pkbxb_di" bpmnElement="Flow_12pkbxb">
        <di:waypoint x="420" y="177" />
        <di:waypoint x="480" y="177" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0etx8vl_di" bpmnElement="Flow_0etx8vl">
        <di:waypoint x="580" y="177" />
        <di:waypoint x="635" y="177" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0q548we_di" bpmnElement="Flow_0q548we">
        <di:waypoint x="870" y="177" />
        <di:waypoint x="982" y="177" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1k2os5v_di" bpmnElement="Flow_1k2os5v">
        <di:waypoint x="685" y="177" />
        <di:waypoint x="770" y="177" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0zyhysy_di" bpmnElement="Flow_0zyhysy">
        <di:waypoint x="660" y="202" />
        <di:waypoint x="660" y="280" />
        <di:waypoint x="370" y="280" />
        <di:waypoint x="370" y="217" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1dqg7jg_di" bpmnElement="Flow_1dqg7jg">
        <di:waypoint x="-110" y="177" />
        <di:waypoint x="-40" y="177" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_00nnl2s_di" bpmnElement="Flow_00nnl2s">
        <di:waypoint x="230" y="177" />
        <di:waypoint x="320" y="177" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0jf2rzh_di" bpmnElement="Flow_0jf2rzh">
        <di:waypoint x="60" y="177" />
        <di:waypoint x="130" y="177" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1bb8s6f_di" bpmnElement="Flow_1bb8s6f">
        <di:waypoint x="-252" y="177" />
        <di:waypoint x="-210" y="177" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
