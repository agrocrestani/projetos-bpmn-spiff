<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:spiffworkflow="http://spiffworkflow.org/bpmn/schema/1.0/core" id="Definitions_96f6665" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="3.0.0-dev">
  <bpmn:process id="Captura_peso" isExecutable="true">
    <bpmn:startEvent id="StartEvent_1">
      <bpmn:outgoing>Flow_02uccst</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:exclusiveGateway id="Gateway_1rnkzle" default="Flow_02mnku9">
      <bpmn:incoming>Flow_0su40cm</bpmn:incoming>
      <bpmn:incoming>Flow_0dio0c2</bpmn:incoming>
      <bpmn:outgoing>Flow_02mnku9</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="Flow_02uccst" sourceRef="StartEvent_1" targetRef="Activity_17r1rt8" />
    <bpmn:sequenceFlow id="Flow_02mnku9" sourceRef="Gateway_1rnkzle" targetRef="Activity_007xqg9" />
    <bpmn:sequenceFlow id="Flow_0n6tzwn" sourceRef="Activity_007xqg9" targetRef="Activity_0s06rpa" />
    <bpmn:exclusiveGateway id="Gateway_061ylz2" default="Flow_12e2x2a">
      <bpmn:incoming>Flow_1hy2wc1</bpmn:incoming>
      <bpmn:outgoing>Flow_12e2x2a</bpmn:outgoing>
      <bpmn:outgoing>Flow_0su40cm</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="Flow_1hy2wc1" sourceRef="Activity_0s06rpa" targetRef="Gateway_061ylz2" />
    <bpmn:sequenceFlow id="Flow_12e2x2a" sourceRef="Gateway_061ylz2" targetRef="Activity_0qc07vy" />
    <bpmn:sequenceFlow id="Flow_1ir5fu6" sourceRef="Activity_0qc07vy" targetRef="Gateway_1st2d98" />
    <bpmn:sequenceFlow id="Flow_0lx66wh" sourceRef="Activity_13xkt89" targetRef="Activity_14way3h" />
    <bpmn:exclusiveGateway id="Gateway_0uwbqlw" default="Flow_0jxo6i8">
      <bpmn:incoming>Flow_1ivy0jm</bpmn:incoming>
      <bpmn:outgoing>Flow_0jxo6i8</bpmn:outgoing>
      <bpmn:outgoing>Flow_0kxj0jx</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="Flow_1ivy0jm" sourceRef="Activity_14way3h" targetRef="Gateway_0uwbqlw" />
    <bpmn:sequenceFlow id="Flow_0jxo6i8" sourceRef="Gateway_0uwbqlw" targetRef="Activity_1y45w5e" />
    <bpmn:endEvent id="Event_1aks153">
      <bpmn:incoming>Flow_1v683fk</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="Flow_1v683fk" sourceRef="Activity_1y45w5e" targetRef="Event_1aks153" />
    <bpmn:scriptTask id="Activity_007xqg9" name="Primeira Pesagem">
      <bpmn:incoming>Flow_02mnku9</bpmn:incoming>
      <bpmn:outgoing>Flow_0n6tzwn</bpmn:outgoing>
      <bpmn:script>from connectordb.captura_peso import capturar
from datetime import datetime

try:
    primeiro_peso_automatico = int(capturar(ip, porta, fabricante))
    data_pesagem_inicial = datetime.now().strftime("%d/%m/%Y %H:%M:%S")
except:
    primeiro_peso_automatico = 0</bpmn:script>
    </bpmn:scriptTask>
    <bpmn:userTask id="Activity_0s06rpa" name="Confirmação Primeiro Peso">
      <bpmn:extensionElements>
        <spiffworkflow:properties>
          <spiffworkflow:property name="formJsonSchemaFilename" value="primeira-pesagem-schema.json" />
          <spiffworkflow:property name="formUiSchemaFilename" value="primeira-pesagem-uischema.json" />
        </spiffworkflow:properties>
        <spiffworkflow:instructionsForEndUser># Informações da Balança

### Primeira Pesagem: {{primeiro_peso_automatico}}</spiffworkflow:instructionsForEndUser>
        <spiffworkflow:postScript>from datetime import datetime

if informar_primeiro_peso_manual:
    data_pesagem_inicial = datetime.now().strftime("%d/%m/%Y %H:%M:%S")</spiffworkflow:postScript>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0n6tzwn</bpmn:incoming>
      <bpmn:outgoing>Flow_1hy2wc1</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:manualTask id="Activity_0qc07vy" name="Descarregar">
      <bpmn:extensionElements>
        <spiffworkflow:instructionsForEndUser>&lt;!DOCTYPE html&gt;
&lt;html lang="pt-BR"&gt;
&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
  &lt;title&gt;Ticket de Pesagem - Armazém&lt;/title&gt;
  &lt;style&gt;
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 20px;
    }
    .ticket-container {
      max-width: 600px;
      margin: 20px auto;
      background-color: #fff3cd;
      border: 1px solid #ddd;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      padding: 20px;
      border-radius: 8px;
    }
    .ticket-header {
      text-align: center;
      margin-bottom: 20px;
    }
    .ticket-header h1 {
      margin: 0;
      font-size: 28px;
      color: #333;
    }
    .ticket-header h2 {
      margin: 5px 0 0;
      font-size: 18px;
      color: #666;
    }
    .ticket-section {
      margin-bottom: 20px;
    }
    .ticket-section p {
      margin: 8px 0;
      font-size: 16px;
      line-height: 1.4;
    }
    .label {
      font-weight: bold;
      color: #444;
    }
    .ticket-summary {
      text-align: center;
      font-size: 20px;
      font-weight: bold;
      color: #007BFF;
      border-top: 1px solid #ddd;
      padding-top: 15px;
    }
    .print-button {
      display: block;
      width: 200px;
      margin: 30px auto 0;
      padding: 10px;
      background-color: #007BFF;
      color: #fff;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
      text-align: center;
    }
    .print-button:hover {
      background-color: #0056b3;
    }
  &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div class="ticket-container"&gt;
    &lt;div class="ticket-header"&gt;
      &lt;h1&gt;Descarregar&lt;/h1&gt;
      &lt;h3&gt;Oriente o motorista a descarregar e ao término você pode prosseguir para segunda pesagem.&lt;/h3&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</spiffworkflow:instructionsForEndUser>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_12e2x2a</bpmn:incoming>
      <bpmn:outgoing>Flow_1ir5fu6</bpmn:outgoing>
    </bpmn:manualTask>
    <bpmn:scriptTask id="Activity_13xkt89" name="Segunda Pesagem">
      <bpmn:incoming>Flow_1x8ovvj</bpmn:incoming>
      <bpmn:outgoing>Flow_0lx66wh</bpmn:outgoing>
      <bpmn:script>from connectordb.captura_peso import capturar
from datetime import datetime

try:
    segundo_peso_automatico = int(capturar(ip, porta, fabricante))
    data_pesagem_final = datetime.now().strftime("%d/%m/%Y %H:%M:%S")
except:
    segundo_peso_automatico = 0
</bpmn:script>
    </bpmn:scriptTask>
    <bpmn:sequenceFlow id="Flow_0su40cm" sourceRef="Gateway_061ylz2" targetRef="Gateway_1rnkzle">
      <bpmn:conditionExpression>repetir_primeira_pesagem == True</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:exclusiveGateway id="Gateway_1st2d98" default="Flow_1x8ovvj">
      <bpmn:incoming>Flow_1ir5fu6</bpmn:incoming>
      <bpmn:incoming>Flow_0kxj0jx</bpmn:incoming>
      <bpmn:outgoing>Flow_1x8ovvj</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="Flow_1x8ovvj" sourceRef="Gateway_1st2d98" targetRef="Activity_13xkt89" />
    <bpmn:sequenceFlow id="Flow_0kxj0jx" sourceRef="Gateway_0uwbqlw" targetRef="Gateway_1st2d98">
      <bpmn:conditionExpression>repetir_segunda_pesagem == True</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:userTask id="Activity_14way3h" name="Confirmação Segundo Peso">
      <bpmn:extensionElements>
        <spiffworkflow:properties>
          <spiffworkflow:property name="formJsonSchemaFilename" value="segunda-pesagem-schema.json" />
        </spiffworkflow:properties>
        <spiffworkflow:instructionsForEndUser># Informações da Balança

### Segunda Pesagem: {{segundo_peso_automatico}}</spiffworkflow:instructionsForEndUser>
        <spiffworkflow:postScript>from datetime import datetime

# Verifica se o primeiro peso foi informado manualmente
if informar_primeiro_peso_manual:
    primeiro_peso = primeiro_peso_manual
else:
    primeiro_peso = primeiro_peso_automatico

# Verifica se o segundo peso foi informado manualmente
if informar_segundo_peso_manual:
    segundo_peso = segundo_peso_manual
    data_pesagem_final = datetime.now().strftime("%d/%m/%Y %H:%M:%S")
else:
    segundo_peso = segundo_peso_automatico

# Verifica qual o maior peso e faz o calculo do peso liquido
if primeiro_peso &gt; segundo_peso:
    peso_bruto = primeiro_peso
    peso_tara = segundo_peso
    peso_liquido = int(primeiro_peso) - int(segundo_peso)
else:
    peso_bruto = segundo_peso
    peso_tara = primeiro_peso
    peso_liquido = int(segundo_peso) - int(primeiro_peso)</spiffworkflow:postScript>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0lx66wh</bpmn:incoming>
      <bpmn:outgoing>Flow_1ivy0jm</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:sequenceFlow id="Flow_0dio0c2" sourceRef="Activity_17r1rt8" targetRef="Gateway_1rnkzle" />
    <bpmn:manualTask id="Activity_1y45w5e" name="Ticket Pesagem">
      <bpmn:extensionElements>
        <spiffworkflow:properties>
          <spiffworkflow:property name="formJsonSchemaFilename" value="" />
          <spiffworkflow:property name="formUiSchemaFilename" value="ticket-pesagem-uischema.json" />
        </spiffworkflow:properties>
        <spiffworkflow:instructionsForEndUser>&lt;!DOCTYPE html&gt;
&lt;html lang="pt-BR"&gt;
&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
  &lt;title&gt;Ticket de Pesagem - Armazém&lt;/title&gt;
  &lt;style&gt;
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 20px;
    }
    .ticket-container {
      max-width: 600px;
      margin: 20px auto;
      background-color: #fff;
      border: 1px solid #ddd;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      padding: 20px;
      border-radius: 8px;
    }
    .ticket-header {
      text-align: center;
      margin-bottom: 20px;
    }
    .ticket-header h1 {
      margin: 0;
      font-size: 28px;
      color: #333;
    }
    .ticket-header h2 {
      margin: 5px 0 0;
      font-size: 18px;
      color: #666;
    }
    .ticket-section {
      margin-bottom: 20px;
      border: 1px solid #ddd;
      padding: 15px;
      border-radius: 5px;
      background-color: #f9f9f9;
    }
    .ticket-section p {
      margin: 8px 0;
      font-size: 16px;
      line-height: 1.4;
    }
    .label {
      font-weight: bold;
      color: #444;
    }
    .ticket-summary {
      text-align: center;
      font-size: 20px;
      font-weight: bold;
      color: #007BFF;
      border-top: 1px solid #ddd;
      padding-top: 15px;
    }
    .print-button {
      display: block;
      width: 200px;
      margin: 30px auto 0;
      padding: 10px;
      background-color: #007BFF;
      color: #fff;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
      text-align: center;
    }
    .print-button:hover {
      background-color: #0056b3;
    }
  &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div class="ticket-container"&gt;
    &lt;div class="ticket-header"&gt;
      &lt;h1&gt;Ticket de Pesagem: {{Codigo}}&lt;/h1&gt;
    &lt;/div&gt;
    &lt;div class="ticket-section"&gt;
      &lt;p&gt;&lt;span class="label"&gt;Data:&lt;/span&gt; {{data_atual}}&lt;/p&gt;
      &lt;p&gt;&lt;span class="label"&gt;Unidade:&lt;/span&gt; {{descricao_filial}}&lt;/p&gt;
      &lt;p&gt;&lt;span class="label"&gt;Placa:&lt;/span&gt; {{placa}}&lt;/p&gt;
      &lt;p&gt;&lt;span class="label"&gt;Motorista:&lt;/span&gt; {{motorista}}&lt;/p&gt;
      &lt;p&gt;&lt;span class="label"&gt;Produto:&lt;/span&gt; {{produto}}&lt;/p&gt;
    &lt;/div&gt;
    &lt;div class="ticket-section"&gt;
{% for t in talhoes %}
      &lt;p&gt;&lt;span class="label"&gt;Talhão:&lt;/span&gt; {{ t['talhao'] }}&lt;span class="label"&gt; Porcentagem Carga:&lt;/span&gt; {{ t['porcentagem_carga'] }}&lt;/p&gt;
{% endfor %}
    &lt;/div&gt;
    &lt;div class="ticket-section"&gt;
      &lt;p&gt;&lt;span class="label"&gt;Peso Bruto:&lt;/span&gt; {{peso_bruto}}&lt;/p&gt;
      &lt;p&gt;&lt;span class="label"&gt;Peso Tara:&lt;/span&gt; {{peso_tara}}&lt;/p&gt;
&lt;div class="ticket-summary"&gt;
      Peso Líquido: {{peso_liquido}}
    &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</spiffworkflow:instructionsForEndUser>
        <spiffworkflow:preScript>from datetime import datetime

# Obtém a data e hora atual
data_atual = datetime.now().strftime("%d/%m/%Y %H:%M:%S")</spiffworkflow:preScript>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0jxo6i8</bpmn:incoming>
      <bpmn:outgoing>Flow_1v683fk</bpmn:outgoing>
    </bpmn:manualTask>
    <bpmn:businessRuleTask id="Activity_17r1rt8" name="Definir balanca">
      <bpmn:extensionElements>
        <spiffworkflow:calledDecisionId>decision_w4b9spf</spiffworkflow:calledDecisionId>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_02uccst</bpmn:incoming>
      <bpmn:outgoing>Flow_0dio0c2</bpmn:outgoing>
    </bpmn:businessRuleTask>
  </bpmn:process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Captura_peso">
      <bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="StartEvent_1">
        <dc:Bounds x="32" y="159" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_1rnkzle_di" bpmnElement="Gateway_1rnkzle" isMarkerVisible="true">
        <dc:Bounds x="265" y="152" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_061ylz2_di" bpmnElement="Gateway_061ylz2" isMarkerVisible="true">
        <dc:Bounds x="695" y="152" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_0uwbqlw_di" bpmnElement="Gateway_0uwbqlw" isMarkerVisible="true">
        <dc:Bounds x="1435" y="152" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_1aks153_di" bpmnElement="Event_1aks153">
        <dc:Bounds x="1702" y="159" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1ig39xd_di" bpmnElement="Activity_007xqg9">
        <dc:Bounds x="370" y="137" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0ic726c_di" bpmnElement="Activity_0s06rpa">
        <dc:Bounds x="530" y="137" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_01il62t_di" bpmnElement="Activity_0qc07vy">
        <dc:Bounds x="810" y="137" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0g2j0ch_di" bpmnElement="Activity_13xkt89">
        <dc:Bounds x="1090" y="137" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_1st2d98_di" bpmnElement="Gateway_1st2d98" isMarkerVisible="true">
        <dc:Bounds x="975" y="152" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1jmdwgc_di" bpmnElement="Activity_14way3h">
        <dc:Bounds x="1260" y="137" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_013zwhj_di" bpmnElement="Activity_1y45w5e">
        <dc:Bounds x="1540" y="137" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0ymkx5b_di" bpmnElement="Activity_17r1rt8">
        <dc:Bounds x="120" y="137" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_02uccst_di" bpmnElement="Flow_02uccst">
        <di:waypoint x="68" y="177" />
        <di:waypoint x="120" y="177" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_02mnku9_di" bpmnElement="Flow_02mnku9">
        <di:waypoint x="315" y="177" />
        <di:waypoint x="370" y="177" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0n6tzwn_di" bpmnElement="Flow_0n6tzwn">
        <di:waypoint x="470" y="177" />
        <di:waypoint x="530" y="177" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1hy2wc1_di" bpmnElement="Flow_1hy2wc1">
        <di:waypoint x="630" y="177" />
        <di:waypoint x="695" y="177" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_12e2x2a_di" bpmnElement="Flow_12e2x2a">
        <di:waypoint x="745" y="177" />
        <di:waypoint x="810" y="177" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1ir5fu6_di" bpmnElement="Flow_1ir5fu6">
        <di:waypoint x="910" y="177" />
        <di:waypoint x="975" y="177" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0lx66wh_di" bpmnElement="Flow_0lx66wh">
        <di:waypoint x="1190" y="177" />
        <di:waypoint x="1260" y="177" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1ivy0jm_di" bpmnElement="Flow_1ivy0jm">
        <di:waypoint x="1360" y="177" />
        <di:waypoint x="1435" y="177" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0jxo6i8_di" bpmnElement="Flow_0jxo6i8">
        <di:waypoint x="1485" y="177" />
        <di:waypoint x="1540" y="177" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1v683fk_di" bpmnElement="Flow_1v683fk">
        <di:waypoint x="1640" y="177" />
        <di:waypoint x="1702" y="177" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0su40cm_di" bpmnElement="Flow_0su40cm">
        <di:waypoint x="720" y="202" />
        <di:waypoint x="720" y="290" />
        <di:waypoint x="290" y="290" />
        <di:waypoint x="290" y="202" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1x8ovvj_di" bpmnElement="Flow_1x8ovvj">
        <di:waypoint x="1025" y="177" />
        <di:waypoint x="1090" y="177" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0kxj0jx_di" bpmnElement="Flow_0kxj0jx">
        <di:waypoint x="1460" y="202" />
        <di:waypoint x="1460" y="290" />
        <di:waypoint x="1000" y="290" />
        <di:waypoint x="1000" y="202" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0dio0c2_di" bpmnElement="Flow_0dio0c2">
        <di:waypoint x="220" y="177" />
        <di:waypoint x="265" y="177" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
