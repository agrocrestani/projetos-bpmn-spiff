<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:spiffworkflow="http://spiffworkflow.org/bpmn/schema/1.0/core" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" id="Definitions_96f6665" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="3.0.0-dev">
  <bpmn:process id="Process_teste_gateway_or_jg9awad" isExecutable="true">
    <bpmn:startEvent id="StartEvent_1">
      <bpmn:outgoing>Flow_17db3yp</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:sequenceFlow id="Flow_17db3yp" sourceRef="StartEvent_1" targetRef="Activity_1mmai9k" />
    <bpmn:manualTask id="Activity_0qpzdpu" name="Define variaveis">
      <bpmn:extensionElements>
        <spiffworkflow:instructionsForEndUser>### carregaMatriz = {{carregaMatriz }}
### carregaQuerencia = {{carregaQuerencia }}</spiffworkflow:instructionsForEndUser>
        <spiffworkflow:preScript>carregaMatriz = 1
carregaQuerencia = 1</spiffworkflow:preScript>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_1dj2xwc</bpmn:incoming>
      <bpmn:outgoing>Flow_0dnvt7r</bpmn:outgoing>
    </bpmn:manualTask>
    <bpmn:sequenceFlow id="Flow_0dnvt7r" sourceRef="Activity_0qpzdpu" targetRef="Gateway_1ls5xhn" />
    <bpmn:inclusiveGateway id="Gateway_1ls5xhn">
      <bpmn:incoming>Flow_0dnvt7r</bpmn:incoming>
      <bpmn:outgoing>Flow_1m51sal</bpmn:outgoing>
      <bpmn:outgoing>Flow_1rtxn9s</bpmn:outgoing>
    </bpmn:inclusiveGateway>
    <bpmn:sequenceFlow id="Flow_1m51sal" sourceRef="Gateway_1ls5xhn" targetRef="Activity_0mk6h2b">
      <bpmn:conditionExpression>carregaMatriz == 1</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_1rtxn9s" sourceRef="Gateway_1ls5xhn" targetRef="Activity_0j9vw6e">
      <bpmn:conditionExpression>carregaQuerencia == 1</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_0zni5ev" sourceRef="Activity_0mk6h2b" targetRef="Gateway_0abgvr8" />
    <bpmn:inclusiveGateway id="Gateway_0abgvr8">
      <bpmn:incoming>Flow_0zni5ev</bpmn:incoming>
      <bpmn:incoming>Flow_0p9abao</bpmn:incoming>
      <bpmn:outgoing>Flow_1253ilp</bpmn:outgoing>
    </bpmn:inclusiveGateway>
    <bpmn:sequenceFlow id="Flow_0p9abao" sourceRef="Activity_0j9vw6e" targetRef="Gateway_0abgvr8" />
    <bpmn:endEvent id="Event_1s2nulu">
      <bpmn:incoming>Flow_1253ilp</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="Flow_1253ilp" sourceRef="Gateway_0abgvr8" targetRef="Event_1s2nulu">
      <bpmn:conditionExpression />
    </bpmn:sequenceFlow>
    <bpmn:userTask id="Activity_0mk6h2b" name="Carrega Matriz">
      <bpmn:extensionElements>
        <spiffworkflow:properties>
          <spiffworkflow:property name="formJsonSchemaFilename" value="carrega-schema.json" />
          <spiffworkflow:property name="formUiSchemaFilename" value="carrega-uischema.json" />
        </spiffworkflow:properties>
        <spiffworkflow:instructionsForEndUser>### carregaMatriz = {{carregaMatriz }}
### carregaQuerencia = {{carregaQuerencia }}</spiffworkflow:instructionsForEndUser>
        <spiffworkflow:postScript />
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_1m51sal</bpmn:incoming>
      <bpmn:outgoing>Flow_0zni5ev</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:userTask id="Activity_0j9vw6e" name="Carrega Querencia">
      <bpmn:extensionElements>
        <spiffworkflow:properties>
          <spiffworkflow:property name="formJsonSchemaFilename" value="carrega-schema.json" />
        </spiffworkflow:properties>
        <spiffworkflow:instructionsForEndUser>### carregaMatriz = {{carregaMatriz }}
### carregaQuerencia = {{carregaQuerencia }}</spiffworkflow:instructionsForEndUser>
        <spiffworkflow:postScript />
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_1rtxn9s</bpmn:incoming>
      <bpmn:outgoing>Flow_0p9abao</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:sequenceFlow id="Flow_1vt7q0m" sourceRef="Activity_1mmai9k" targetRef="Activity_0qvcr8l" />
    <bpmn:userTask id="Activity_1mmai9k" name="Solicitar Insumos">
      <bpmn:extensionElements>
        <spiffworkflow:preScript>n_filiais = []
for f in filiais:
    BPLId = f['BPLId']
    BPLName = f['BPLName']
    AliasName = f['AliasName']
    if BPLId in ['2', '3', '4', '5']: 
        n_filiais.append(
            {
                "value": BPLId,
                "label": AliasName,
            }
        )

n_safras = safras
solicitante = get_current_user()['display_name']
carregaMatriz = 0
carregaQuerencia = 0</spiffworkflow:preScript>
        <spiffworkflow:postScript>solicitacao_bkp = solicitacao</spiffworkflow:postScript>
        <spiffworkflow:properties>
          <spiffworkflow:property name="formJsonSchemaFilename" value="solicitar-insumos-schema.json" />
          <spiffworkflow:property name="formUiSchemaFilename" value="solicitar-insumos-uischema.json" />
        </spiffworkflow:properties>
        <spiffworkflow:instructionsForEndUser># Solicitação de insumos

### Instruções:

1. Selecione a sua unidade;
2. Selecione os itens que deseja para complementar o seu estoque.
3. O pedido sendo aceito pelo Depto de Insumos, o mesmo seguirá na próxima carga, conforme agendamento.
 
-----------

</spiffworkflow:instructionsForEndUser>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_17db3yp</bpmn:incoming>
      <bpmn:outgoing>Flow_1vt7q0m</bpmn:outgoing>
      <bpmn:property id="Property_1jhqerw" name="__targetRef_placeholder" />
      <bpmn:dataInputAssociation id="DataInputAssociation_1xsqehp">
        <bpmn:sourceRef>DataStoreReference_05a6n0k</bpmn:sourceRef>
        <bpmn:targetRef>Property_1jhqerw</bpmn:targetRef>
      </bpmn:dataInputAssociation>
      <bpmn:dataInputAssociation id="DataInputAssociation_0346cku">
        <bpmn:sourceRef>DataStoreReference_1sqlknc</bpmn:sourceRef>
        <bpmn:targetRef>Property_1jhqerw</bpmn:targetRef>
      </bpmn:dataInputAssociation>
    </bpmn:userTask>
    <bpmn:dataStoreReference id="DataStoreReference_1sqlknc" name="Safras" dataStoreRef="safras" type="json" />
    <bpmn:dataStoreReference id="DataStoreReference_05a6n0k" name="Filiais" dataStoreRef="filiais" type="json" />
    <bpmn:sequenceFlow id="Flow_0acl2wc" sourceRef="Activity_0qvcr8l" targetRef="Activity_1tihesz" />
    <bpmn:userTask id="Activity_0qvcr8l" name="Confirma Solicitação">
      <bpmn:extensionElements>
        <spiffworkflow:properties>
          <spiffworkflow:property name="formJsonSchemaFilename" value="confirmar-solicitacao-schema.json" />
          <spiffworkflow:property name="formUiSchemaFilename" value="confirmar-solicitacao-uischema.json" />
        </spiffworkflow:properties>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_1vt7q0m</bpmn:incoming>
      <bpmn:outgoing>Flow_0acl2wc</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:sequenceFlow id="Flow_1ni79v6" sourceRef="Activity_1tihesz" targetRef="Activity_1yt4lw0" />
    <bpmn:businessRuleTask id="Activity_1tihesz" name="Define Cliente">
      <bpmn:extensionElements>
        <spiffworkflow:calledDecisionId>decision_CardCode</spiffworkflow:calledDecisionId>
        <spiffworkflow:postScript>for s in solicitacao:
    s['insumo'] = json.loads(s['insumo'])


descricaoFilial = ""
for f in n_filiais:
    if f['value'] == unidade:
      descricaoFilial = f['label']

usuarioEmissorNFe = get_current_user()['display_name']

SlpCode = 8
OwnerCode = 2
main_usage = []
for u in utilizacoes:
    main_usage.append(u)</spiffworkflow:postScript>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0acl2wc</bpmn:incoming>
      <bpmn:outgoing>Flow_1ni79v6</bpmn:outgoing>
      <bpmn:property id="Property_017x2hi" name="__targetRef_placeholder" />
      <bpmn:dataInputAssociation id="DataInputAssociation_0w4c6xu">
        <bpmn:sourceRef>DataStoreReference_12fjr4t</bpmn:sourceRef>
        <bpmn:targetRef>Property_017x2hi</bpmn:targetRef>
      </bpmn:dataInputAssociation>
    </bpmn:businessRuleTask>
    <bpmn:dataStoreReference id="DataStoreReference_12fjr4t" name="Utilizações" dataStoreRef="utilizacoes" type="json" />
    <bpmn:sequenceFlow id="Flow_1dj2xwc" sourceRef="Activity_1yt4lw0" targetRef="Activity_0qpzdpu" />
    <bpmn:userTask id="Activity_1yt4lw0" name="Confirma Pedido">
      <bpmn:extensionElements>
        <spiffworkflow:instructionsForEndUser># &lt;font color="blue"&gt;Prévia da NFe que será emitida.&lt;/font&gt; 

{% if lancado and (lancado != 201) %}
    &lt;font color="red"&gt;&lt;strong&gt;Ocorreu um erro na inserção dos dados no SAP. Tente novamente, caso persista, procure o TI. &lt;/strong&gt;&lt;/font&gt;
{% endif %}


| Código | Descrição | Quantidade | UN| Deposito |
| --------- | ------------ | :---------------: | ---- | --------- |
{%for s in solicitacao %}
| {{s['insumo']['ItemCode']}} | {{s['insumo']['ItemName']}} | {{s['quantidade']}} | {{s['insumo']['InvntryUom']}} | {{s['insumo']['WhsCode']}} |
{%endfor%}

## Dados para NFe

| Campo | Valor
| --------- | ------------ | 
| Filial Destino: |{{descricaoFilial}}|
| Códgo Cliente: | {{CardCode}} |
| Vededor: | {{SlpCode}} |
| Titular:    | {{OwnerCode}} |
| Solicitante: | {{solicitante}}
| Usuario Emissor NFe: | {{usuarioEmissorNFe}}|


-----------


</spiffworkflow:instructionsForEndUser>
        <spiffworkflow:properties>
          <spiffworkflow:property name="formJsonSchemaFilename" value="confirmar-pedido-schema.json" />
          <spiffworkflow:property name="formUiSchemaFilename" value="confirmar-pedido-uischema.json" />
        </spiffworkflow:properties>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_1ni79v6</bpmn:incoming>
      <bpmn:outgoing>Flow_1dj2xwc</bpmn:outgoing>
    </bpmn:userTask>
  </bpmn:process>
  <bpmn:dataStore id="safras" name="JSONDataStore" />
  <bpmn:dataStore id="filiais" name="JSONDataStore" />
  <bpmn:dataStore id="utilizacoes" name="JSONDataStore" />
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Process_teste_gateway_or_jg9awad">
      <bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="StartEvent_1">
        <dc:Bounds x="-18" y="159" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0zqotmb_di" bpmnElement="Activity_0qpzdpu">
        <dc:Bounds x="970" y="137" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_17vz534_di" bpmnElement="Gateway_1ls5xhn">
        <dc:Bounds x="1125" y="152" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_1yhsh0t_di" bpmnElement="Gateway_0abgvr8">
        <dc:Bounds x="1385" y="152" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_1s2nulu_di" bpmnElement="Event_1s2nulu">
        <dc:Bounds x="1492" y="159" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1gof64r_di" bpmnElement="Activity_0mk6h2b">
        <dc:Bounds x="1230" y="137" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1vv948k_di" bpmnElement="Activity_0j9vw6e">
        <dc:Bounds x="1230" y="250" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0k9gyrq_di" bpmnElement="Activity_1mmai9k">
        <dc:Bounds x="90" y="137" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="DataStoreReference_1sqlknc_di" bpmnElement="DataStoreReference_1sqlknc">
        <dc:Bounds x="55" y="285" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="63" y="342" width="35" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="DataStoreReference_05a6n0k_di" bpmnElement="DataStoreReference_05a6n0k">
        <dc:Bounds x="105" y="285" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="116" y="342" width="28" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0ww4plg_di" bpmnElement="Activity_0qvcr8l">
        <dc:Bounds x="270" y="137" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0354git_di" bpmnElement="Activity_1tihesz">
        <dc:Bounds x="440" y="137" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="DataStoreReference_12fjr4t_di" bpmnElement="DataStoreReference_12fjr4t">
        <dc:Bounds x="435" y="285" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="433" y="342" width="54" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_105ofwe_di" bpmnElement="Activity_1yt4lw0">
        <dc:Bounds x="610" y="137" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_17db3yp_di" bpmnElement="Flow_17db3yp">
        <di:waypoint x="18" y="177" />
        <di:waypoint x="90" y="177" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0dnvt7r_di" bpmnElement="Flow_0dnvt7r">
        <di:waypoint x="1070" y="177" />
        <di:waypoint x="1125" y="177" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1m51sal_di" bpmnElement="Flow_1m51sal">
        <di:waypoint x="1175" y="177" />
        <di:waypoint x="1230" y="177" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1rtxn9s_di" bpmnElement="Flow_1rtxn9s">
        <di:waypoint x="1150" y="202" />
        <di:waypoint x="1150" y="290" />
        <di:waypoint x="1230" y="290" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0zni5ev_di" bpmnElement="Flow_0zni5ev">
        <di:waypoint x="1330" y="177" />
        <di:waypoint x="1385" y="177" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0p9abao_di" bpmnElement="Flow_0p9abao">
        <di:waypoint x="1330" y="290" />
        <di:waypoint x="1410" y="290" />
        <di:waypoint x="1410" y="202" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1253ilp_di" bpmnElement="Flow_1253ilp">
        <di:waypoint x="1435" y="177" />
        <di:waypoint x="1492" y="177" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1vt7q0m_di" bpmnElement="Flow_1vt7q0m">
        <di:waypoint x="190" y="177" />
        <di:waypoint x="270" y="177" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="DataInputAssociation_1xsqehp_di" bpmnElement="DataInputAssociation_1xsqehp">
        <di:waypoint x="132" y="285" />
        <di:waypoint x="139" y="217" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="DataInputAssociation_0346cku_di" bpmnElement="DataInputAssociation_0346cku">
        <di:waypoint x="95" y="285" />
        <di:waypoint x="134" y="217" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0acl2wc_di" bpmnElement="Flow_0acl2wc">
        <di:waypoint x="370" y="177" />
        <di:waypoint x="440" y="177" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1ni79v6_di" bpmnElement="Flow_1ni79v6">
        <di:waypoint x="540" y="177" />
        <di:waypoint x="610" y="177" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="DataInputAssociation_0w4c6xu_di" bpmnElement="DataInputAssociation_0w4c6xu">
        <di:waypoint x="467" y="285" />
        <di:waypoint x="487" y="217" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1dj2xwc_di" bpmnElement="Flow_1dj2xwc">
        <di:waypoint x="710" y="177" />
        <di:waypoint x="970" y="177" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
